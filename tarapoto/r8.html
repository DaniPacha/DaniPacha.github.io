<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Progr. Deportivos TARAPOTO</title>
    <link rel="shortcut icon" type="image/x-icon" href="../aide-excel.ico" />
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha512-SfTiTlX6kk+qitfevl/7LibUOeJWlt9rbyDn92a1DqWOw9vWG2MFoays0sgObmWazO5BQPiFucnnEAjpAB+/Sw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js" integrity="sha384-cuYeSxntonz0PPNlHhBs68uyIAVpIIOZZ5JqeqvYYIcEL727kskC66kF92t6Xl2V" crossorigin="anonymous"></script>
    
</head>
<style>
    .pointer{
        cursor: pointer;
    }
    .pointer:hover{
        color: yellow;
    }
    .table-hover.table-hover-dark > tbody > tr:hover > * {
        background-color: #484848;
        color: #ddd;
        transition: all 0.3s;
    }
    
    .pl-5{
        padding-left: 5rem;
        padding-right: 5rem;
    }

    #text_resultados{
      color: white;
      line-height: 36px;
      min-width: 180px;
      text-align: right;
      margin-right: 10px;;
    }

    .hide {display:none;}

    .red {color:Red !important;}
</style>
<body>
    <nav class="navbar  navbar-dark bg-dark navbar-expand-lg bg-light">
        <div class="container-fluid container-xxl">
          <a class="navbar-brand" href="index.html">AIDE</a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarScroll" aria-controls="navbarScroll" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarScroll">
            <ul class="navbar-nav me-auto my-2 my-lg-0 navbar-nav-scroll" style="--bs-scroll-height: 100px;">
              <li class="nav-item">
                <a class="nav-link " aria-current="page" href="r4.html">R4 Capac.Docente</a>
              </li>
              <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="#">R8 Progr. Deportivos</a>
              </li>
              <li class="nav-item">
                <a class="nav-link " aria-current="page" href="r9.html">R9 Proy. Social</a>
              </li>
              <li class="nav-item">
                <a class="nav-link " aria-current="page" href="r10.html">R10 Inv. e Innov.</a>
              </li>      
              <li class="nav-item">
                <a class="nav-link" aria-current="page" href="r2.html">R2.2 R3 Infra. y Equipam.</a>
              </li>             
              <li class="nav-item">
                <a class="nav-link" aria-current="page" href="compras_dolares.html">Compras Dólares</a>
              </li>             
            </ul>
            <form class="d-flex" role="search">
              <span id="text_resultados" class="inline-block"></span>
              <input id="searchTerm" class="form-control me-2" type="search" placeholder="Buscar..."  onkeyup="doSearch()" aria-label="Search">
              <!-- <button class="btn btn-outline-primary" type="button">Buscar</button> -->
            </form>
          </div>
        </div>
      </nav>
    <div class="container-fluid">
        <h1 class="">Programa Deportivos (4142035-4) TARAPOTO<span class="badge text-bg-light pointer" data-bs-toggle="collapse" data-bs-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample" style="font-size: 0.33em;"> <i class="fa fa-chevron-down" aria-hidden="true"></i></span></h1>
        <div class="collapse" id="collapseExample">
            <input id="f_token" type="text" class="form-control" placeholder="ahjHGFkjGKJG54JHGJ57HKGDFdwsL65" value="X">
          </div>
        <!-- <hr> -->
        <div class="table-responsive"  style="max-height: 800px">
            <table id="datos_compras" class="table table-responsive table-responsive-sm table-striped-columns table-hover table-hover-dark" style="font-size: 10.8px;" >
                <thead>
                    <tr class="table-primary ">
                        <th>#</th>
                        <th>Archivos</th>
                        <th>Cuenta-Cta.Cte</th>  
                        <th>Departm.</th>  
                        <th>Descripcion Asiento</th>  
                        <th>Imp Asiento</th>  
                        <th>Razon Social</th>  
                        <th>RUC</th>  
                        <th>Tipo Comp.</th>  
                        <th>Serie-Numero</th>  
                        <th>Nro Compr.</th>    
                        <th>Imp.Total Compr.</th>   
                        <th>IGV Compr.</th>   
                        <th>Fecha Comp.</th>  
                        <th>Fecha Prov.</th> 
                        <th>Lote Compra</th>  
                        <th>Imp Pago</th>  
                        <th>Imp Pago Dolares</th>  
                        <th>Num Oper.</th>  
                        <th>Fecha Pago</th>  
                        <th>Lote Pago</th> 
                        <th>Fecha Lote Pago</th>  
                        <th>Retención</th> 
                        <th>Detracción</th>  
                        
                    </tr>
                </thead>
                <tbody>
                    <tr><td align="right">	1	</td><td><span class="pointer" onclick="descargar_pago(360949)"><i class="fa fa-eye" aria-hidden="true"></i> Docs</span>	</td><td>4142035-4	</td><td>61010204	</td><td>7124- F001-60204 | Palos de Banderines. | palos para banderines	</td><td align="right"><b>10.00	</b></td><td>Ferreteria Santa Rosa E.I.R.L. - 	</td><td><b>20450285189	</b></td><td>FACTURA	</td><td>F001-60204	</td><td>000000060204	</td><td align="right"><b>10.00	</td><td align="right"><b>0.00	</b></td><td>02/04/24	</td><td>17/04/24	</td><td>RCT 7	</td><td align="right"><b>      10.00	</b></td><td align="right">       0.00	</td><td>33772	</td><td>09/05/24	</td><td>MIT 4	</td><td>09/05/24	</td><td>	</td><td>	</td></tr>
                    <tr><td align="right">	2	</td><td><span class="pointer" onclick="descargar_pago(360972)"><i class="fa fa-eye" aria-hidden="true"></i> Docs</span>	</td><td>4142035-4	</td><td>61010204	</td><td>7124- F004-4219 | compra de pilas/balanza | Compra de pilas para balan	</td><td align="right"><b>10.50	</b></td><td>Tecnologias Sigtel Sociedad Anonima Cerrada - Tecnologias Sigtel S.A.C. - 	</td><td><b>20600230337	</b></td><td>FACTURA	</td><td>F004-4219	</td><td>000000004219	</td><td align="right"><b>10.50	</td><td align="right"><b>0.00	</b></td><td>04/04/24	</td><td>18/04/24	</td><td>RCT 7	</td><td align="right"><b>      10.50	</b></td><td align="right">       0.00	</td><td>33772	</td><td>09/05/24	</td><td>MIT 4	</td><td>09/05/24	</td><td>	</td><td>	</td></tr>
                    <tr><td align="right">	3	</td><td><span class="pointer" onclick="descargar_pago(476735)"><i class="fa fa-eye" aria-hidden="true"></i> Docs</span>	</td><td>4142035-4	</td><td>61010204	</td><td>7124- E001-129 | Prodac/uniformes | Programa deportivo de alta compete	</td><td align="right"><b>1,320.00	</b></td><td>Corporacion Mgm Sociedad Anonima Cerrada Corporacion Mgm Sociedad Anonima Cerrada 	</td><td><b>20572137521	</b></td><td>FACTURA	</td><td>E001-129	</td><td>000000000129	</td><td align="right"><b>1,320.00	</td><td align="right"><b>0.00	</b></td><td>28/08/24	</td><td>09/10/24	</td><td>RCT 2	</td><td align="right"><b>   1,320.00	</b></td><td align="right">       0.00	</td><td>1230754	</td><td>10/10/24	</td><td>MBT 19	</td><td>10/10/24	</td><td>	</td><td>	</td></tr>
                    <tr><td align="right">	4	</td><td><span class="pointer" onclick="descargar_pago(514401)"><i class="fa fa-eye" aria-hidden="true"></i> Docs</span>	</td><td>4142035-4	</td><td>61010204	</td><td>7124- E001-1054 | Evento deportivo/prodac | Evento deportivo PRODAC	</td><td align="right"><b>110.40	</b></td><td>Huaman Tocas Albujar Giraldo - 	</td><td><b>10470011373	</b></td><td>FACTURA	</td><td>E001-1054	</td><td>000000001054	</td><td align="right"><b>110.40	</td><td align="right"><b>0.00	</b></td><td>27/11/24	</td><td>29/11/24	</td><td>RCT 15	</td><td align="right"><b>     110.40	</b></td><td align="right">       0.00	</td><td>1035753	</td><td>11/12/24	</td><td>MBT 22	</td><td>11/12/24	</td><td>	</td><td>	</td></tr>
                    <tr><td align="right">	5	</td><td><span class="pointer" onclick="descargar_pago(514404)"><i class="fa fa-eye" aria-hidden="true"></i> Docs</span>	</td><td>4142035-4	</td><td>61010204	</td><td>7124- E001-1056 | evento deportivo/prodac | Evento deportivo PRODAC	</td><td align="right"><b>110.40	</b></td><td>Huaman Tocas Albujar Giraldo - 	</td><td><b>10470011373	</b></td><td>FACTURA	</td><td>E001-1056	</td><td>000000001056	</td><td align="right"><b>110.40	</td><td align="right"><b>0.00	</b></td><td>28/11/24	</td><td>29/11/24	</td><td>RCT 15	</td><td align="right"><b>     110.40	</b></td><td align="right">       0.00	</td><td>1035753	</td><td>11/12/24	</td><td>MBT 22	</td><td>11/12/24	</td><td>	</td><td>	</td></tr>
                    
                </tbody>

            </table>
        </div>
    </div>
    

  
  <!-- Modal -->
  <div class="modal fade" id="modal_docs" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="staticBackdropLabel">Documentos</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <ul class="list-group list-group-flush " id="lista_docs">
                
                
            </ul>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
        </div>
      </div>
    </div>
  </div>


  <div class="modal fade" id="modal_error" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5 text-danger text" id="staticBackdropLabel"><i class="fa fa-exclamation-triangle" aria-hidden="true"></i> Error!</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <p class="">Token caducado! <i class="fa fa-frown-o" aria-hidden="true"></i></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
        </div>
      </div>
    </div>
  </div>

    





    

<script>

let list_docs_html ="";
let _TOKEN = "eu1qaGYmZnYYG5VIsLYxVz6F4XSRgB";   
//c6daGqeTgtdERDMVDatRto9gnynoGa

const myModal = new bootstrap.Modal(document.getElementById('modal_docs'), {
  keyboard: true,
  focus: true
});

const myModalError = new bootstrap.Modal(document.getElementById('modal_error'), {
  keyboard: true,
  focus: true
});




function    descargar_compra(id_pcompra){
    let TOKEN = document.getElementById('f_token').value;
    if(TOKEN == "X"){
        TOKEN = _TOKEN;
    }

    const xhr = new XMLHttpRequest();
    xhr.open("GET", "https://api-lamb.upeu.edu.pe/purchases-v1/api/task/order-all-file/"+id_pcompra);
    xhr.setRequestHeader("Authorization", TOKEN);
    
    xhr.send();
    xhr.responseType = "json";
    xhr.onload = () => {
    if (xhr.readyState == 4 && xhr.status == 200) {
        const data = xhr.response;
        console.log(data);
        window.open(data[0].url, '_blank');
    } else {
        console.log(`Error: ${xhr.status}`);
    }
    };
}

function descargar_pago(id_pcompra){
    let TOKEN = document.getElementById('f_token').value;
    if(TOKEN == "X"){
        TOKEN = _TOKEN;
    }

    list_docs_html = "";
    const xhr = new XMLHttpRequest();
    xhr.open("GET", "https://api-lamb.upeu.edu.pe/purchases-v1/api/task/order-all-file/"+id_pcompra);
    xhr.setRequestHeader("Authorization", TOKEN);
    
    xhr.send();
    xhr.responseType = "json";
    xhr.onload = () => {
    if (xhr.readyState == 4 && xhr.status == 200) {
        const data = xhr.response;
        console.log(data);

        data.forEach((file, index) => {
            let _doc = "";
            if(file.tipo=="3"){_doc="Compra"}else if(file.tipo=="1" || file.tipo=="12"){_doc="Pago TLC"}else if(file.tipo=="5"){_doc = "Sustento"}else if(file.tipo=="14"){_doc = "Detrac."}
            list_docs_html += '<li class="list-group-item"><span class="badge text-bg-success">'+_doc+' </span> '+file.nombre+' <a class="badge text-bg-warning" href="'+file.url+'" target="_blank"> Ver doc <i class="fa fa-download" aria-hidden="true"></i></a></li>';
        });

        document.getElementById("lista_docs").innerHTML = list_docs_html;
        
        console.log("abriendo modal");



        myModal.show();
        //window.open(data[0].url, '_blank');
    } else {
        console.log(`Error: ${xhr.status}`);
        myModalError.show();
    }
    };
}




function doSearch(){

  const tableReg = document.getElementById('datos_compras');

  const searchText = document.getElementById('searchTerm').value.toLowerCase();

  let total = 0;



  // Recorremos todas las filas con contenido de la tabla

  for (let i = 1; i < tableReg.rows.length; i++) {

      // Si el td tiene la clase "noSearch" no se busca en su cntenido

      if (tableReg.rows[i].classList.contains("noSearch")) {

          continue;

      }



      let found = false;

      const cellsOfRow = tableReg.rows[i].getElementsByTagName('td');

      // Recorremos todas las celdas

      for (let j = 0; j < cellsOfRow.length && !found; j++) {

          const compareWith = cellsOfRow[j].innerHTML.toLowerCase();

          // Buscamos el texto en el contenido de la celda

          if (searchText.length == 0 || compareWith.indexOf(searchText) > -1) {

              found = true;

              total++;

          }

      }

      if (found) {

      tableReg.rows[i].style.display = '';

      } else {

      // si no ha encontrado ninguna coincidencia, esconde la

      // fila de la tabla

      tableReg.rows[i].style.display = 'none';

      }

  }
  
  // mostramos las coincidencias

  const msj_busqueda = document.getElementById("text_resultados");

  msj_busqueda.classList.remove("hide", "red");

  if (searchText == "") {

    msj_busqueda.classList.add("hide");

  } else if (total) {

    msj_busqueda.innerHTML="Hay <b>"+total+"</b> coincidencia"+((total>1)?"s":"");

  } else {

    msj_busqueda.classList.add("red");

    msj_busqueda.innerHTML="<b>0</b> coincidencias";

  }

}






</script>
</body>
</html>